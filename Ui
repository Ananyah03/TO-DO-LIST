import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.FileWriter;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

public class JsonUI extends JFrame {
    private List<PluginData> familyPlugins;
    private List<ScriptData> setupScripts;
    private JPanel inputPanel;
    private JPanel scriptPanel;

    public JsonUI() {
        familyPlugins = new ArrayList<>();
        setupScripts = new ArrayList<>();

        setTitle("Family Plugins and Setup Scripts Input");
        setSize(800, 600);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLayout(new BorderLayout());

        JTabbedPane tabbedPane = new JTabbedPane();

        // Family Plugins Panel
        inputPanel = new JPanel();
        inputPanel.setLayout(new BoxLayout(inputPanel, BoxLayout.Y_AXIS));
        addPluginInputFields(); // Add the first set of input fields

        tabbedPane.add("Family Plugins", new JScrollPane(inputPanel));

        // Setup Scripts Panel
        scriptPanel = new JPanel();
        scriptPanel.setLayout(new BoxLayout(scriptPanel, BoxLayout.Y_AXIS));
        addScriptInputFields(); // Add the first set of input fields

        tabbedPane.add("Setup Scripts", new JScrollPane(scriptPanel));

        add(tabbedPane, BorderLayout.CENTER);
    }

    private void addPluginInputFields() {
        JPanel panel = new JPanel(new GridBagLayout());
        GridBagConstraints gbc = new GridBagConstraints();
        gbc.insets = new Insets(5, 5, 5, 5);
        gbc.fill = GridBagConstraints.HORIZONTAL;

        JLabel typeLabel = new JLabel("Type:");
        JTextField typeField = new JTextField(20);

        JLabel idLabel = new JLabel("ID:");
        JTextField idField = new JTextField(20);

        gbc.gridx = 0;
        gbc.gridy = 0;
        panel.add(typeLabel, gbc);

        gbc.gridx = 1;
        gbc.gridy = 0;
        panel.add(typeField, gbc);

        gbc.gridx = 0;
        gbc.gridy = 1;
        panel.add(idLabel, gbc);

        gbc.gridx = 1;
        gbc.gridy = 1;
        panel.add(idField, gbc);

        inputPanel.add(panel);

        JPanel buttonPanel = new JPanel(new FlowLayout(FlowLayout.RIGHT));
        JButton addButton = new JButton("Add Another");
        addButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                addPluginInputFields();
            }
        });
        buttonPanel.add(addButton);

        JButton saveButton = new JButton("Save");
        saveButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                String type = typeField.getText();
                String id = idField.getText();

                if (!type.isEmpty() && !id.isEmpty()) {
                    familyPlugins.add(new PluginData(type, id));
                    JOptionPane.showMessageDialog(JsonUI.this, "Plugin saved!");
                    saveToJson();
                } else {
                    JOptionPane.showMessageDialog(JsonUI.this, "Please fill in all fields.");
                }
            }
        });
        buttonPanel.add(saveButton);

        JButton deleteButton = new JButton("Delete");
        deleteButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                int option = JOptionPane.showConfirmDialog(JsonUI.this, "Are you sure you want to delete this entry?", "Confirmation", JOptionPane.YES_NO_OPTION);
                if (option == JOptionPane.YES_OPTION) {
                    inputPanel.remove(panel);
                    inputPanel.remove(buttonPanel);
                    inputPanel.revalidate();
                    inputPanel.repaint();
                    familyPlugins.removeIf(plugin -> plugin.type.equals(typeField.getText()) && plugin.id.equals(idField.getText()));
                    saveToJson(); // Update JSON after deletion
                }
            }
        });
        buttonPanel.add(deleteButton);

        inputPanel.add(buttonPanel);
        inputPanel.revalidate();
        inputPanel.repaint();
    }

    private void addScriptInputFields() {
        JPanel panel = new JPanel(new GridBagLayout());
        GridBagConstraints gbc = new GridBagConstraints();
        gbc.insets = new Insets(5, 5, 5, 5);
        gbc.fill = GridBagConstraints.HORIZONTAL;

        JLabel typeLabel = new JLabel("Type:");
        JTextField typeField = new JTextField(20);

        JLabel nameLabel = new JLabel("Name:");
        JTextField nameField = new JTextField(20);

        JLabel scriptLabel = new JLabel("Script:");
        JTextArea scriptField = new JTextArea(10, 20);
        scriptField.setLineWrap(true);
        scriptField.setWrapStyleWord(true);
        JScrollPane scrollPane = new JScrollPane(scriptField);

        gbc.gridx = 0;
        gbc.gridy = 0;
        panel.add(typeLabel, gbc);

        gbc.gridx = 1;
        gbc.gridy = 0;
        panel.add(typeField, gbc);

        gbc.gridx = 0;
        gbc.gridy = 1;
        panel.add(nameLabel, gbc);

        gbc.gridx = 1;
        gbc.gridy = 1;
        panel.add(nameField, gbc);

        gbc.gridx = 0;
        gbc.gridy = 2;
        panel.add(scriptLabel, gbc);

        gbc.gridx = 1;
        gbc.gridy = 2;
        gbc.gridwidth = 2;
        gbc.fill = GridBagConstraints.BOTH;
        panel.add(scrollPane, gbc);

        scriptPanel.add(panel);

        JPanel buttonPanel = new JPanel(new FlowLayout(FlowLayout.RIGHT));
        JButton addButton = new JButton("Add Another");
        addButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                addScriptInputFields();
            }
        });
        buttonPanel.add(addButton);

        JButton saveButton = new JButton("Save");
        saveButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                String type = typeField.getText();
                String name = nameField.getText();
                String script = scriptField.getText();

                if (!type.isEmpty() && !name.isEmpty() && !script.isEmpty()) {
                    setupScripts.add(new ScriptData(type, name, script));
                    JOptionPane.showMessageDialog(JsonUI.this, "Script saved!");
                    saveToJson();
                } else {
                    JOptionPane.showMessageDialog(JsonUI.this, "Please fill in all fields.");
                }
            }
        });
        buttonPanel.add(saveButton);

        JButton deleteButton = new JButton("Delete");
        deleteButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                int option = JOptionPane.showConfirmDialog(JsonUI.this, "Are you sure you want to delete this entry?", "Confirmation", JOptionPane.YES_NO_OPTION);
                if (option == JOptionPane.YES_OPTION) {
                    scriptPanel.remove(panel);
                    scriptPanel.remove(buttonPanel);
                    scriptPanel.revalidate();
                    scriptPanel.repaint();
                    setupScripts.removeIf(script -> script.type.equals(typeField.getText()) && script.name.equals(nameField.getText()) && script.script.equals(scriptField.getText()));
                    saveToJson(); // Update JSON after deletion
                }
            }
        });
        buttonPanel.add(deleteButton);

        scriptPanel.add(buttonPanel);
        scriptPanel.revalidate();
        scriptPanel.repaint();
    }

    private void saveToJson() {
        try (FileWriter writer = new FileWriter("family_plugins_and_setup_scripts.json")) {
            writer.write(toJsonString());
            JOptionPane.showMessageDialog(this, "Data saved to family_plugins_and_setup_scripts.json");
        } catch (IOException e) {
            JOptionPane.showMessageDialog(this, "Error saving to JSON file: " + e.getMessage());
        }
    }

    private String toJsonString() {
        StringBuilder json = new StringBuilder();
        json.append("{\n");

        json.append("  \"familyPlugins\": [\n");
        for (int i = 0; i < familyPlugins.size(); i++) {
            PluginData plugin = familyPlugins.get(i);
            json.append("    {\n");
            json.append("      \"type\": \"").append(plugin.type).append("\",\n");
            json.append("      \"id\": \"").append(plugin.id).append("\"\n");
            if (i < familyPlugins.size() - 1) {
                json.append("    },\n");
            } else {
                json.append("    }\n");
            }
        }
        json.append("  ],\n");

        json.append("  \"setupScripts\": [\n");
        for (int i = 0; i < setupScripts.size(); i++) {
            ScriptData script = setupScripts.get(i);
            json.append("    {\n");
            json.append("      \"type\": \"").append(script.type).append("\",\n");
            json.append("      \"name\": \"").append(script.name).append("\",\n");
            json.append("      \"script\": \"").append(script.script.replace("\n", "\\n").replace("\"", "\\\"")).append("\"\n");
            if (i < setupScripts.size() - 1) {
                json.append("    },\n");
            } else {
                json.append("    }\n");
            }
        }
        json.append("  ]\n");

        json.append("}\n");
        return json.toString();
    }

    private static class PluginData {
        String type;
        String id;

        PluginData(String type, String id) {
            this.type = type;
            this.id = id;
        }
    }

    private static class ScriptData {
        String type;
        String name;
        String script;

        ScriptData(String type, String name, String script) {
            this.type = type;
            this.name = name;
            this.script = script;
        }
    }

    public static void main(String[] args) {
        SwingUtilities.invokeLater(new Runnable() {
            @Override
            public void run() {
                new JsonUI().setVisible(true);
            }
        });
    }
}
